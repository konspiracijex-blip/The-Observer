<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M4TR1X ARG - FINAL V26 (FIKS ZA MOBILNI HEADER V2)</title>
    <style>
        /* CSS STILIZACIJA TERMINALA */
        body {
            background-color: black;
            color: #00FF00; 
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            /* DEFAULT PADDING (ZA DESKTOP) */
            margin: 0;
            padding: 20px;
            height: 100vh;
            overflow: hidden; 
            box-sizing: border-box;
            cursor: default; 
            touch-action: manipulation;
            
            /* Fleksbox za bolju kontrolu visine na mobilnim uređajima */
            display: flex;
            flex-direction: column;
        }

        /* MEDIA QUERY ZA MOBILNE UREĐAJE (manje od 600px širine) */
        @media screen and (max-width: 600px) {
            body {
                /* SMANJEN GORNJI PADDING ZA MOBILNE UREĐAJE */
                padding: 5px 10px 10px 10px; /* Top 5px, Ostalo 10px */
            }
        }

        #terminal {
            white-space: pre-wrap;
            flex-grow: 1; 
            height: 100%; /* U kombinaciji sa body flexboxom ovo daje bolju kontrolu */
            overflow-y: auto;
            outline: none; 
            transition: color 1s, background-color 1s;
        }
        
        .shutdown {
            color: black !important;
            background-color: black !important;
        }

        /* STIL ZA SKRIVENI INPUT */
        #hiddenInput {
            position: absolute;
            opacity: 0;
            top: 0;
            left: 0;
            height: 0;
            width: 0;
            padding: 0;
            margin: 0;
            border: none;
            caret-color: transparent; 
            -webkit-user-select: none;
            user-select: none;
        }

        /* Stil za trepćući kursor */
        .cursor {
            display: inline-block;
            width: 10px;
            height: 1.2em;
            background-color: #00FF00;
            vertical-align: text-bottom;
            animation: blinker 1s step-end infinite;
        }

        @keyframes blinker {
            from, to { opacity: 0; }
            50% { opacity: 1; }
        }

        #userInputDisplay {
            display: inline-block;
            min-width: 5px; 
        }

        #currentLine {
            display: flex; 
            align-items: baseline; 
            min-width: 100%; 
            display: none; 
        }

        .success-message {
            color: #00FF00;
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div id="terminal" tabindex="0">
        <input type="text" id="hiddenInput" autofocus autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
        
        <div id="output">
            </div>
        <div id="currentLine">
            <span id="prompt"></span>
            <span id="userInputDisplay"></span>
            <span class="cursor" id="inputCursor"></span> 
        </div>
    </div>

    <script>
        // JAVASCRIPT LOGIKA IGRE
        document.addEventListener('DOMContentLoaded', () => {
            const terminalDiv = document.getElementById('terminal');
            const outputDiv = document.getElementById('output');
            const promptSpan = document.getElementById('prompt');
            const currentLineDiv = document.getElementById('currentLine'); 
            const userInputDisplay = document.getElementById('userInputDisplay');
            const hiddenInput = document.getElementById('hiddenInput');
            
            let inputActive = false; 
            // Fazni tok: 1: Login, 2: YES/NO, 3: Zagonetka 1 (future), 4: Zagonetka 2 (key), 5: Zagonetka 3 (1776), 6: Zagonetka 4 (13), 7: Zagonetka 5 (shadow), 8: Zagonetka 6 (Area 51), 9: Izlaz (trinity)
            let gamePhase = 1; 
            let currentInput = ""; 
            
            const CORRECT_LOGIN = "observer"; 
            const FINAL_EXIT_CODE = "trinity"; 
            
            // Logika Nivoa 3 (Zagonetka 1: future)
            const RIDDLE_1_TEXT = "It’s the future, a shadow that stretches before you. You can sense it, feel its shape, but it never reveals itself - always just out of reach, always waiting.";
            const RIDDLE_1_ANSWER = "future"; 
            
            // Logika Nivoa 4 (Zagonetka 2: key)
            const RIDDLE_2_TEXT = "Keep your steps quiet as you move through the deserted streets.\nEvery shadow stretches, every whisper hides a secret.\nYou feel it, the hidden truth, just beyond perception - waiting for the one who notices.";
            const RIDDLE_2_ANSWER = "key"; 
            
            // Logika Nivoa 5 (Zagonetka 3: 1776)
            const RIDDLE_3_TEXT = "True power lies hidden in the text that everyone can read, where history meets secret societies. The pyramid on the seal conceals the moment when shadows first joined forces.\n\nFind it, study it carefully, and uncover the number.";
            const RIDDLE_3_ANSWER = "1776"; 

            // Logika Nivoa 6 (Zagonetka 4: 13)
            const RIDDLE_4_TEXT = "An unfinished pyramid watches over the seal, silent and looming.\nEach layer tells a story, a hidden mark of power and order.\nThe original colonies lie beneath its shadow, whispered by the ancients.\n\nDiscover the number that connects the past to the secrets above.";
            const RIDDLE_4_ANSWER = "13"; 

            // Logika Nivoa 7 (Zagonetka 5: shadow)
            const RIDDLE_5_TEXT = "A message drifts through the static, a code hidden in dots and dashes.\nOnly those who listen carefully can hear what is whispered.\n\n... .... .- -.. --- .--";
            const RIDDLE_5_ANSWER = "shadow"; 
            
            // Logika Nivoa 8 (Zagonetka 6: Area 51)
            const RIDDLE_6_TEXT = "Accessing restricted map layer...\nDecryption needed.\nLocation Hidden in Plain Sight:\n37.247456, -115.801709";
            const RIDiddle_6_ANSWERS = ["area 51", "area51"];


            // TEKST ZA PISAĆU MAŠINU (Uvod u Nivo 2)
            const TYPEWRITER_TEXT = "Everywhere around you are visible walls, invisible locks. The world you live in is not the one you think you know. People sleep, believing what they’re told, not what they could discover themselves. So I ask you: are you an observer or a participant? Just another number in a system that uses you, or ready to uncover the truth within the matrix and pass through it? If you seek the truth, you must earn it. The doors open only to those who understand the hidden language.\n\nAre you ready? - YES / NO";

            // SEKVENCE GAŠENJA
            const SHUTDOWN_MESSAGES = [
                { text: "Shutdown sequence initiated.", delay: 300 },
                { text: "Closing network protocols...", delay: 200, color: '#FF0000' },
                { text: "Deactivating security matrix...", delay: 400 },
                { text: "All secure channels closing.", delay: 300 },
                { text: "Unmounting HDD-WREN...", delay: 200 },
                { text: "System powering down...", delay: 1000, color: '#FF0000' }
            ];

            // BOOT SEKVENCE
            const BOOT_MESSAGES = [
                { text: "OBSERVER BIOS v4.51 (c) 1969 OBSERVER Systems Ltd.", delay: 100 }, 
                { text: "CPU: Intel i960GX Tactical (OK)", delay: 150 },
                { text: "Memory Test: Instruction Cache: 4 KB, Data Cache: 1 KB (Passed)", delay: 150 },
                { text: "Scanning for drives...", delay: 300 },
                { text: "HDD-WREN detected and mounted.", delay: 200 }, 
                { text: "Loading OS...", delay: 500 },
                { text: "Starting Kernel 2.1.99 - OBSERVER Secure Boot", delay: 200 },
                { text: "Initializing network protocols... [OK]", delay: 200 },
                { text: "Connecting to Gateway 01...", delay: 500 },
                { text: "System OBSERVER 2.1 Booted. Waiting for Authentication.", delay: 800, color: '#00FF00' } 
            ];
            
            // POMOĆNE FUNKCIJE
            function clearScreen() {
                outputDiv.innerHTML = '';
            }

            function outputText(text, isError = false, isCode = false, color = null) {
                const p = document.createElement('div');
                p.textContent = text;
                if (isError) {
                    p.style.color = '#FF0000'; 
                } else if (isCode) {
                    p.classList.add('code-block');
                } else if (color) {
                    p.style.color = color;
                }
                outputDiv.appendChild(p);
                terminalDiv.scrollTop = terminalDiv.scrollHeight; 
            }

            // FUNKCIJA ZA PISAĆU MAŠINU (Brzina: 8ms)
            function typeWriter(text, speed = 8, callback) {
                const element = document.createElement('span'); 
                const container = document.createElement('div');
                container.appendChild(element);
                outputDiv.appendChild(container);
                terminalDiv.scrollTop = terminalDiv.scrollHeight;

                let i = 0;
                function type() {
                    if (i < text.length) {
                        if (text.charAt(i) === '\n') {
                            element.appendChild(document.createElement('br'));
                        } else {
                            element.innerHTML += text.charAt(i); 
                        }
                        i++;
                        setTimeout(type, speed);
                    } else if (callback) {
                        callback();
                    }
                }
                type();
            }

            // FUNKCIJA ZA DETEKCIJU MOBILNOG
            function isMobileDevice() {
                // Jednostavna provera za popularne mobilne potpise u User Agent stringu
                return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
            }


            // SEKVENCA GAŠENJA
            function shutdownSequence() {
                inputActive = false;
                currentLineDiv.style.display = 'none';
                clearScreen();

                let delay = 0;
                SHUTDOWN_MESSAGES.forEach(msg => {
                    delay += msg.delay;
                    setTimeout(() => {
                        outputText(msg.text, false, false, msg.color);
                        if (msg === SHUTDOWN_MESSAGES[SHUTDOWN_MESSAGES.length - 1]) {
                            setTimeout(() => {
                                terminalDiv.classList.add('shutdown');
                                outputDiv.innerHTML = '';
                            }, 500); 
                        }
                    }, delay);
                });
            }

            // SEKVENCE IGRE
            
            function startBootSequence() {
                let delay = 0;
                BOOT_MESSAGES.forEach(msg => {
                    delay += msg.delay;
                    setTimeout(() => {
                        outputText(msg.text, false, false, msg.color);
                        if (msg === BOOT_MESSAGES[BOOT_MESSAGES.length - 1]) {
                            activateInput(1); 
                        }
                    }, delay);
                });
            }
            
            function startLevel2() {
                inputActive = false;
                currentLineDiv.style.display = 'none';
                clearScreen();

                typeWriter(TYPEWRITER_TEXT, 8, () => {
                    activateInput(2); 
                });
            }

            function startLevel3() {
                inputActive = false;
                currentLineDiv.style.display = 'none';
                clearScreen();

                typeWriter(RIDDLE_1_TEXT, 8, () => {
                    activateInput(3); 
                });
            }

            // NIVO 4 (ZAGONETKA 2)
            function startLevel4() {
                inputActive = false;
                currentLineDiv.style.display = 'none';
                clearScreen();

                typeWriter(RIDDLE_2_TEXT, 8, () => {
                    activateInput(4); 
                });
            }
            
            // NIVO 5 (ZAGONETKA 3)
            function startLevel5() {
                inputActive = false;
                currentLineDiv.style.display = 'none';
                clearScreen();

                typeWriter(RIDDLE_3_TEXT, 8, () => {
                    activateInput(5); 
                });
            }

            // NIVO 6 (ZAGONETKA 4)
            function startLevel6() {
                inputActive = false;
                currentLineDiv.style.display = 'none';
                clearScreen();

                typeWriter(RIDDLE_4_TEXT, 8, () => {
                    activateInput(6); 
                });
            }

            // NIVO 7 (ZAGONETKA 5)
            function startLevel7() {
                inputActive = false;
                currentLineDiv.style.display = 'none';
                clearScreen();

                typeWriter(RIDDLE_5_TEXT, 8, () => {
                    activateInput(7); 
                });
            }

            // NIVO 8 (ZAGONETKA 6)
            function startLevel8() {
                inputActive = false;
                currentLineDiv.style.display = 'none';
                clearScreen();

                typeWriter(RIDDLE_6_TEXT, 8, () => {
                    activateInput(8); 
                });
            }


            // Nivo 9 je Izlaz
            
            function activateInput(phase) {
                gamePhase = phase;
                if (phase === 1) promptSpan.textContent = "Login: ";
                if (phase === 2) promptSpan.textContent = ">> ";
                if (phase === 3) promptSpan.textContent = "Answer: "; 
                if (phase === 4) promptSpan.textContent = "Answer: "; 
                if (phase === 5) promptSpan.textContent = "Number: "; 
                if (phase === 6) promptSpan.textContent = "Number: "; 
                if (phase === 7) promptSpan.textContent = "Word: "; 
                if (phase === 8) promptSpan.textContent = "Answer: "; 
                if (phase === 9) promptSpan.textContent = "C:\\SYSTEM> "; 

                currentLineDiv.style.display = 'flex'; 
                inputActive = true; 
                hiddenInput.focus(); 
            }

            // LOGIKE ZA KOMANDE I ODGOVORE
            
            function handleLogin(input) {
                if (input === CORRECT_LOGIN) {
                    inputActive = false;
                    currentLineDiv.style.display = 'none';
                    terminalDiv.classList.remove('shutdown');

                    clearScreen();
                    outputText("ACCESS GRANTED. Entering the system...", false);
                    
                    setTimeout(startLevel2, 1500); 
                    
                } else if (input.length > 0) {
                    outputText("Unknown user. Authentication failure.", true); 
                } else {
                    outputText("Empty input. Try again.", true);
                }
            }
            
            function handleYesNo(input) {
                if (input === 'yes') {
                    outputText("Truth acknowledged. Prepare for instruction.", false);
                    startLevel3(); 
                } else if (input === 'no') {
                    outputText("Choice declined. Shutting down system...", false);
                    shutdownSequence(); 
                } else {
                    outputText(`Invalid response: ${input.toUpperCase()}. Enter YES or NO.`, true);
                }
            }
            
            // Logika Nivoa 3 (Zagonetka 1: future)
            function handleRiddle1(input) {
                if (input === RIDDLE_1_ANSWER) {
                    inputActive = false;
                    currentLineDiv.style.display = 'none';
                    
                    outputText("Well done!", false);
                    outputText("Not everyone sees what you just uncovered.", false);
                    outputText("Proceed with caution.", false);
                    
                    // POZIV NIVO 4 (ZAGONETKA KEY)
                    setTimeout(() => {
                        startLevel4(); 
                    }, 1500);
                    
                } else {
                    outputText("Incorrect. Re-read the message and try again.", true);
                }
            }

            // Logika Nivoa 4 (Zagonetka 2: key)
            function handleRiddle2(input) {
                if (input === RIDDLE_2_ANSWER) {
                    inputActive = false;
                    currentLineDiv.style.display = 'none';
                    
                    outputText("ACCESS GRANTED.", false);
                    outputText("KEY detected. Proceed.", false);
                    
                    // POZIV NIVO 5 (ZAGONETKA 1776)
                    setTimeout(() => {
                        startLevel5(); 
                    }, 1500);
                    
                } else {
                    outputText("Incorrect. Re-read the message and try again.", true);
                }
            }
            
            // Logika Nivoa 5 (Zagonetka 3: 1776)
            function handleRiddle3(input) {
                if (input === RIDDLE_3_ANSWER) {
                    inputActive = false;
                    currentLineDiv.style.display = 'none';
                    
                    outputText("HISTORY ACKNOWLEDGED. The circle is complete.", false);
                    
                    // POZIV NIVO 6 (ZAGONETKA 13)
                    setTimeout(() => {
                        startLevel6(); 
                    }, 1500);
                    
                } else {
                    outputText("Incorrect. That number does not align with the hidden truth.", true);
                }
            }

            // Logika Nivoa 6 (Zagonetka 4: 13)
            function handleRiddle4(input) {
                if (input === RIDDLE_4_ANSWER) {
                    inputActive = false;
                    currentLineDiv.style.display = 'none';
                    
                    outputText("THE COLONIES REMEMBER. The final layer is exposed.", false);
                    
                    // POZIV NIVO 7 (ZAGONETKA SHADOW)
                    setTimeout(() => {
                        startLevel7(); 
                    }, 1500);
                    
                } else {
                    outputText("Incorrect. The past holds the key. Re-evaluate the layers.", true);
                }
            }

            // Logika Nivoa 7 (Zagonetka 5: shadow)
            function handleRiddle5(input) {
                if (input === RIDDLE_5_ANSWER) {
                    inputActive = false;
                    currentLineDiv.style.display = 'none';
                    
                    outputText("CODE BROKEN. Silence speaks volumes.", false);
                    
                    // POZIV NIVO 8 (ZAGONETKA AREA 51)
                    setTimeout(() => {
                        startLevel8(); 
                    }, 1500);
                    
                } else {
                    outputText("Incorrect. Listen carefully to the static. Decode the message.", true);
                }
            }

            // Logika Nivoa 8 (Zagonetka 6: Area 51)
            function handleRiddle6(input) {
                // Provera da li je input u nizu dozvoljenih odgovora
                if (RIDiddle_6_ANSWERS.includes(input)) {
                    inputActive = false;
                    currentLineDiv.style.display = 'none';
                    
                    outputText("LOCATION CONFIRMED. The truth is out there.", false);
                    
                    // Čekanje 1.5 sekunde, brisanje, prelazak na Nivo 9 (Izlaz)
                    setTimeout(() => {
                        clearScreen();
                        activateInput(9); 
                        outputText("FINAL COMMAND REQUIRED: Enter the exit code to terminate the Matrix connection.", false);
                    }, 1500);
                    
                } else {
                    // PROMENA PORUKE O GREŠCI
                    outputText("Incorrect. Decryption failed.", true);
                }
            }


            // Logika Nivoa 9 (Izlaz: trinity)
            function handleExit(input) {
                if (input === FINAL_EXIT_CODE) {
                    outputText("SYSTEM EXIT CODE ACCEPTED.", false);
                    outputText("Thank you, Neo. The world is saved.", false);
                    outputText("ACCESS DEBLOCKED. Exiting the Matrix...", false);
                    
                    const finalMsg = document.createElement('div');
                    finalMsg.classList.add('success-message');
                    finalMsg.textContent = ">> GAME OVER: CONNECTION TERMINATED <<";
                    outputDiv.appendChild(finalMsg);

                    document.removeEventListener('keydown', keydownHandler);
                    terminalDiv.removeEventListener('click', clickHandler);
                    hiddenInput.removeEventListener('input', inputHandler);
                    hiddenInput.removeEventListener('change', changeHandler);
                    inputActive = false; 
                } else {
                    outputText("ERROR: Invalid Exit Code.", true);
                }
            }
            
            // RUKOVODILAC UNOSOM (Glavni switch)
            const processInput = (fullInput) => {
                if (!inputActive) return; 
                
                if (fullInput === '') {
                     userInputDisplay.textContent = '';
                     currentInput = '';
                     return; 
                }
                
                const inputLower = fullInput.trim().toLowerCase();
                
                outputText(`${promptSpan.textContent}${fullInput}`);

                if (gamePhase === 1) {
                    handleLogin(inputLower);
                } else if (gamePhase === 2) {
                    handleYesNo(inputLower);
                } else if (gamePhase === 3) {
                    handleRiddle1(inputLower);
                } else if (gamePhase === 4) {
                    handleRiddle2(inputLower); 
                } else if (gamePhase === 5) {
                    handleRiddle3(inputLower); 
                } else if (gamePhase === 6) {
                    handleRiddle4(inputLower); 
                } else if (gamePhase === 7) {
                    handleRiddle5(inputLower); 
                } else if (gamePhase === 8) {
                    handleRiddle6(inputLower); 
                } else if (gamePhase === 9) {
                    handleExit(inputLower);
                }

                currentInput = "";
                userInputDisplay.textContent = "";
            };

            // LOGIKA UNOSA I RUKOVANJE DOGAĐAJIMA 
            
            const keydownHandler = (e) => {
                if (!inputActive) return; 
                // Ovo je primarno za desktop. Na mobilnom hiddenInput rukuje unosom.
                if (e.ctrlKey || e.altKey || e.metaKey) return; 
                if (document.activeElement !== terminalDiv) return;

                if (e.key.length === 1 && e.key.match(/^[a-zA-Z0-9\s.,!?-]$/)) { 
                    e.preventDefault(); 
                    currentInput += e.key;
                    userInputDisplay.textContent = currentInput;
                } else if (e.key === 'Backspace') {
                    e.preventDefault(); 
                    currentInput = currentInput.slice(0, -1);
                    userInputDisplay.textContent = currentInput;
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    processInput(currentInput);
                }
                terminalDiv.focus(); 
            };
            document.addEventListener('keydown', keydownHandler);

            // RUKOVANJE UNOSOM IZ SKRIVENOG POLJA (hiddenInput)
            const inputHandler = () => {
                if (!inputActive) return; 
                
                let rawInput = hiddenInput.value;
                
                if (isMobileDevice()) {
                    // FIKS ZA "UNAZAD ISPISIVANJE" KOJE SE DEŠAVA SAMO NA NEKIM MOBILNIM SISTEMIMA
                    currentInput = rawInput.split('').reverse().join(''); 
                } else {
                    // NORMALAN UNOS ZA DESKTOP PRETRAŽIVAČE
                    currentInput = rawInput; 
                }
                
                userInputDisplay.textContent = currentInput;
            };
            hiddenInput.addEventListener('input', inputHandler);

            const changeHandler = () => {
                if (!inputActive) return; 
                // Koristi currentInput, koji je već obrađen u inputHandler
                processInput(currentInput);
                hiddenInput.value = '';
                currentInput = '';
            };
            hiddenInput.addEventListener('change', changeHandler);


            const clickHandler = (e) => {
                if (!inputActive) return; 
                if (e.target !== hiddenInput) {
                    e.preventDefault(); 
                    hiddenInput.focus();
                }
            };
            terminalDiv.addEventListener('click', clickHandler);
            
            // START GAME: Initiate Boot Sequence
            startBootSequence();
        });
    </script>
</body>
</html>
