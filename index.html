<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>OBSERVER - NIVO 1</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            background:#000; color:#00FF00; font-family:'Press Start 2P',monospace;
            margin:0;padding:20px;height:100vh;overflow-y:auto;position:relative;
            text-shadow:0 0 5px rgba(0,255,0,.7);
        }
        .terminal{max-width:800px;margin:0 auto;white-space:pre-wrap;min-height:100vh;}
        .game-title{font-size:3.2em;color:#FF0000;text-align:center;margin:0 0 6px;font-weight:bold;
            text-shadow:0 0 10px rgba(255,0,0,.7);}
        .system-info{font-size:.9em;color:#00FF00;text-align:center;margin-bottom:12px;}
        .input-row{display:flex;flex-direction:column;align-items:center;margin-top:8px;}
        .visible-input{display:inline-flex;align-items:center;gap:8px;}
        .messages-row{text-align:center;margin-top:12px;}
        #feedback-fail,#feedback-success{white-space:pre-wrap;line-height:1.6;max-width:90%;margin:6px auto;text-align:center;}
        .cursor{background:#00FF00;color:#000;padding:0 6px;animation:blink 1s step-start infinite;}
        @keyframes blink{50%{opacity:0}}
        .hidden{display:none}
        #hidden-input{position:absolute;opacity:0;width:1px;height:1px;border:none;left:0;top:0}
        @media(max-width:600px){body{font-size:12px;padding:10px}.game-title{font-size:1.6em}}
    </style>
</head>
<body>
    <div class="terminal" id="terminal-container">
        <div id="boot-sequence"></div>

        <div id="game-content" class="hidden">
            <div class="game-title">OBSERVER</div>
            <div class="system-info" id="system-info">SISTEM 1101 / VER. 2.6</div>

            <!-- login area -->
            <div id="input-row" class="input-row">
                <span class="visible-input">Unesite šifru: <span id="user-input-display"></span><span class="cursor" id="fake-cursor">_</span></span>

                <input id="hidden-input" type="text" inputmode="text" enterkeyhint="done"
                       autocorrect="off" autocapitalize="characters" spellcheck="false" autocomplete="off" />

                <div class="messages-row">
                    <div id="feedback-success" class="hidden"></div>
                    <div id="feedback-fail" class="hidden"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const terminal = document.getElementById('terminal-container');
        const bootSequence = document.getElementById('boot-sequence');
        const gameContent = document.getElementById('game-content');
        const inputRow = document.getElementById('input-row');
        const hiddenInput = document.getElementById('hidden-input');
        const display = document.getElementById('user-input-display');
        const fakeCursor = document.getElementById('fake-cursor');
        const failDiv = document.getElementById('feedback-fail');
        const successDiv = document.getElementById('feedback-success');
        const gameTitle = document.querySelector('.game-title');
        const systemInfo = document.getElementById('system-info');

        const CORRECT = 'OBSERVER';
        const BOOT_DELAY = 200;
        const MAX_ATTEMPTS = 5;
        const HINT_AT = 3;

        let current = '';
        let attempts = 0;
        let typingTimer = null;
        let failTimer = null;

        const bootMsgs = [
            'CHECKING CORE COMPONENTS...',
            'RAM: 640K OK',
            'HDD: DRIVE C: ACCESS GRANTED',
            'LOADING OBSERVER OS... SISTEM 1101',
            'NETWORK CONNECTION... ONLINE [WANTED]',
            'INITIATING OBSERVER PROTOCOL...',
            'WARNING: ACCESS IS RESTRICTED.',
            'AWAITING USER INPUT...'
        ];

        function runBoot(index=0){
            if(index < bootMsgs.length){
                const p=document.createElement('p'); p.textContent=bootMsgs[index];
                bootSequence.appendChild(p);
                bootSequence.scrollTop = bootSequence.scrollHeight;
                window.scrollTo(0,document.body.scrollHeight);
                setTimeout(()=>runBoot(index+1), BOOT_DELAY);
            } else {
                bootSequence.style.display='none';
                gameContent.classList.remove('hidden');
                hiddenInput.focus();
            }
        }

        function typeText(target, text, speed=40){
            if(!target) return;
            target.classList.remove('hidden'); target.style.display='block'; target.textContent='';
            let i=0;
            (function next(){
                if(i<text.length){ target.textContent += text.charAt(i++); typingTimer = setTimeout(next, speed); }
            })();
        }

        function clearFailImmediately(){
            if(failTimer){ clearTimeout(failTimer); failTimer = null; }
            if(failDiv){ failDiv.classList.add('hidden'); failDiv.style.display='none'; failDiv.textContent=''; }
        }

        function showFail(text, {flash=true, duration=1000} = {}){
            clearFailImmediately();
            if(!failDiv) return;
            failDiv.textContent = text;
            failDiv.classList.remove('hidden'); failDiv.style.display='block';
            if(flash) failDiv.classList.add('fail-flash'); else failDiv.classList.remove('fail-flash');
            failTimer = setTimeout(()=>{ if(failDiv){ failDiv.classList.add('hidden'); failDiv.style.display='none'; failDiv.textContent=''; } failTimer=null; }, duration);
        }

        // --- NEW LEVEL 2 (completely new, replaces previous) ---
        function enterLevel2New(){
            // hide login input row completely
            if(inputRow){ inputRow.classList.add('hidden'); inputRow.style.display='none'; }
            // update subtitle to requested text
            if(systemInfo) systemInfo.textContent = 'Odobren pristup A2';
            // show the new prompt content in successDiv
            successDiv.classList.remove('hidden'); successDiv.style.display='block';
            successDiv.innerHTML = `
                <div id="level2-box" style="text-align:center;">
                    <p style="font-weight:bold; color:#FF0000; margin:0.3em 0;">OBSERVER</p>
                    <p style="margin:0.6em 0; color:#00FF00;">Dobrodošli!</p>
                    <p style="margin:0.2em 0; color:#00FF00;">"Da li si zaista spreman da čuješ?"</p>
                    <p style="margin:0.2em 0; color:#00FF00;">(DA/NE)</p>
                    <div id="level2-response" style="margin-top:10px; color:#00FF00;"></div>
                </div>
            `;
            // enable and focus hidden input so user types answer
            hiddenInput.disabled = false;
            hiddenInput.value = '';
            hiddenInput.focus();

            // echo typed value into visible response
            const respEl = document.getElementById('level2-response');
            function onInput(e){ if(respEl) respEl.textContent = e.target.value.toUpperCase(); }

            // handle Enter for DA/NE
            function onKey(e){
                if(e.key !== 'Enter') return;
                e.preventDefault();
                const val = hiddenInput.value.trim().toUpperCase();
                if(val === 'DA' || val === 'D'){
                    successDiv.innerHTML = `<p style="color:#00FF00; font-weight:bold;">PRIHVAĆENO — NIVO 2 POKRENUT.</p>`;
                    hiddenInput.removeEventListener('input', onInput);
                    hiddenInput.removeEventListener('keydown', onKey);
                    hiddenInput.disabled = true;
                    if(fakeCursor) fakeCursor.style.display = 'none';
                    // place to initialize real level-2 logic
                } else if(val === 'NE' || val === 'N'){
                    successDiv.innerHTML = `<p style="color:#FF0000;">Odustali ste. Vraćam sistem.</p>`;
                    hiddenInput.removeEventListener('input', onInput);
                    hiddenInput.removeEventListener('keydown', onKey);
                    hiddenInput.disabled = true;
                    if(fakeCursor) fakeCursor.style.display = 'none';
                    setTimeout(()=>location.reload(), 1200);
                } else {
                    if(respEl) respEl.textContent = 'Unesite DA ili NE';
                    hiddenInput.value = '';
                    hiddenInput.focus();
                }
            }

            // attach listeners
            hiddenInput.addEventListener('input', onInput);
            hiddenInput.addEventListener('keydown', onKey);
        }

        // --- login handlers ---
        hiddenInput.addEventListener('input', (e) => {
            current = e.target.value.toUpperCase();
            display.textContent = current;
        });

        hiddenInput.addEventListener('keydown', (e) => {
            if(e.key !== 'Enter') return;
            e.preventDefault();
            clearFailImmediately();
            if(typingTimer){ clearTimeout(typingTimer); typingTimer = null; }

            const answer = current.trim().toUpperCase();
            if(answer === CORRECT){
                // proceed to new level 2
                hiddenInput.disabled = true;
                if(fakeCursor) fakeCursor.style.display = 'none';
                terminal.classList.add('flash-red');
                setTimeout(()=>{ terminal.classList.remove('flash-red'); systemInfo.textContent = 'PRISTUP ODOBREN'; enterLevel2New(); }, 300);
                return;
            }

            // wrong answer handling
            attempts++;
            if(attempts === HINT_AT){
                typeText(failDiv, "Postojim na obe strane stakla: i u onome što se gleda i u onome ko gleda.", 40);
                hiddenInput.disabled = true;
                if(fakeCursor) fakeCursor.style.display = 'none';
                setTimeout(()=>{
                    if(typingTimer){ clearTimeout(typingTimer); typingTimer = null; }
                    if(failDiv){ failDiv.classList.add('hidden'); failDiv.style.display='none'; failDiv.textContent=''; }
                    hiddenInput.disabled = false;
                    if(fakeCursor) fakeCursor.style.display = 'inline-block';
                    current=''; display.textContent=''; hiddenInput.value=''; hiddenInput.focus();
                }, 7000);
                return;
            }

            if(attempts >= MAX_ATTEMPTS){
                showFail("PRISTUP ODBIJEN.! SISTEM SE RESETUJE!", {flash:true, duration:2000});
                hiddenInput.disabled = true;
                if(fakeCursor) fakeCursor.style.display = 'none';
                setTimeout(()=>location.reload(), 2300);
                return;
            }

            showFail("PRISTUP ODBIJEN! Pokusajte ponovo.", {flash:true, duration:1000});
            current=''; display.textContent=''; hiddenInput.value=''; hiddenInput.focus();
        });

        // start
        runBoot(0);

        // focus on click
        document.body.addEventListener('click', ()=>{ if(!hiddenInput.disabled) hiddenInput.focus(); });
    });
    </script>
</body>
</html>
